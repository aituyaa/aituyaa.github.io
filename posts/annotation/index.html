<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="注解 - https://loveminimal.github.io/posts/annotation/">
    <meta name="author" content="Jack - https://loveminimal.github.io/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>注解</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://loveminimal.github.io/style.min.588bdbe244863f48f211eae6ac79640e39689f34e9568c6f2789c5519ab60956.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate ">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"isSingleColumnOfPostList": true,
		"hasFoldAllCodeBlocks": false,
		"svgColor": "",
		"en": false,
		"dark": false
	}
</div>
    <h1 class="title">
        
            注解
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill="#6c757d" p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill="#6c757d"></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill="#6c757d"></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill="#6c757d" p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill="#6c757d" p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill="#6c757d" p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill="#6c757d" p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill="#6c757d"></path></svg></a></div>
        
    </div>

    
</div>

            <div id="toc">📜</div>
        
    
    
</div>
</div>
        <div id="content">















<div class="container-main 
     container-page 
">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2022-07-05&nbsp;
        </span>
        <span>
            
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2023-05-08&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            4704 字</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            10 分钟</span>
            <div class="container-ctgtag">
	<div class="taxonomy">
		
		<div class="ctg">
			
			
			<a href="/categories/java">Java</a>
			
		</div>
		<div class="tag">
			
			 - 
			
			<a href="/tags/spring">Spring</a>
			
		</div>
	</div>
</div>
        
    </div>
    
    <div class="toc">
        
        <div class="page-operation">
            <div><a href="#"><img src="/imgs/icons/arrow-up-circle.svg" alt=""></a></div>
            <div><a href="https://loveminimal.github.io/posts/editor-keybindings/"><img src="/imgs/icons/arrow-left-circle.svg" alt=""></a></div>
            <div><a href="https://loveminimal.github.io/posts/spring-boot/"><img src="/imgs/icons/arrow-right-circle.svg" alt=""></a></div>
        </div>
        
        <nav id="TableOfContents">
  <ul>
    <li><a href="#注解是什么">注解是什么</a></li>
    <li><a href="#定义注解">定义注解</a></li>
    <li><a href="#处理注解">处理注解</a></li>
    <li><a href="#应用注解">应用注解</a>
      <ul>
        <li><a href="#在-servlet-中的应用">在 Servlet 中的应用</a></li>
        <li><a href="#在-spring-中的应用">在 Spring 中的应用</a></li>
        <li><a href="#在-spring-mvc-中的应用">在 Spring MVC 中的应用</a></li>
        <li><a href="#在-spring-boot-中的应用">在 Spring Boot 中的应用</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  content '>
        <p>🔔 以下内容主要摘录自 <a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1255945389098144">廖雪峰老师的博客</a>，具体示例请跳到原文参考。</p>
<img src="/posts/annotation/imgs/1.jpg" width="" style="float: ;" />
<blockquote>
<p>= 好吧，廖老师配图一直可以的。</p>
</blockquote>
<h2 id="注解是什么">注解是什么</h2>
<p>注解是什么呢？它和注释有什么区别？</p>
<blockquote>
<p>注解定义后也是一种 <code>class</code> ，所有的注解都继承自 <code>java.lang.annotaion.Annotation</code> 。 OK，我们先看看注解是做什么用的，再来了解如何定义和使用它。</p>
</blockquote>
<p>注解是放在 Java 源码的类、方法、字段、参数前的一种特殊的“注释”（注意并不是注释），是一种用做标注的“元数据”。如，我们日常使用的 <code>@Override</code> 就是一种注解。</p>
<p>从 JVM 的角度看，注解本身对代码逻辑没有任何影响，如何使用注解完全由工具决定。</p>
<div class="oh-essay">
其实这里的意思时，注解的作用取决于你是如何定义注解和使用注解的方法的。注解，就像是你在代码的某个位置放的一个钩子，至于如何使用它，则完全由你决定。
</div>
<p>Java 的注解可以分为三类：</p>
<ol>
<li>由编译器使用的注解；</li>
<li>由工具处理 <code>.class</code> 文件使用的注解；</li>
<li>在程序运行运行期能够读取的注解。</li>
</ol>
<p>第一类，编译器使用的注解，如 <code>@Override</code> 让编译器检查该方法是否正确地实现了覆写， <code>@SuppressWarnings</code> 告诉编译器忽略此处代码产生的警告等。这类注解不会被编译进入 <code>.class</code> 文件，它们在编译后就被编译器扔掉了。（😿）</p>
<p>第二类，由工具处理 <code>.class</code> 文件使用的注解，比如有些工具会在加载 class 的时候，对 class 做动态修改，以实现一些特殊的功能。这类注解会被编译进入 <code>.class</code> 文件，但在类加载结束后并不会存在于内存中（使命已经完成了，仅作用于 class）。它只被一些底层库使用，一般不必我们自己处理。</p>
<p>第三类，在程序运行期能够读取的注解，这类注解在加载后一起存在于 JVM（内存中啦） 中（因为要在运行期读取啦 😏），这也是最常用的注解。</p>
<p>OK，了解了注解是什么，有什么用之后 ，让我们来看一下如何定义一个注解吧。</p>
<h2 id="定义注解">定义注解</h2>
<p>Java 语言使用 <code>@interface</code> 语法来定义注解，它的格式如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#3c5d5d;font-weight:bold">@interface</span> Report <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">type</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">default</span> 0<span style="color:#000;font-weight:bold">;</span>			<span style="color:#998;font-style:italic">// default 后就是默认值
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>	String <span style="color:#900;font-weight:bold">level</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">default</span> <span style="color:#d14">&#34;info&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>	String <span style="color:#900;font-weight:bold">value</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">default</span> <span style="color:#d14">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><blockquote>
<p>注解定义后也是一种 class，所有的注解都继承自 <code>java.lang.annotation.Annotation</code> 。</p>
</blockquote>
<p>不难看出，在定义一个注解时，还可以定义配置参数。需要注意的是，配置参数必须是常量，在定义注解时就已经确定了每个参数的值（可以有默认值）。</p>
<p>*大部分注解会有一个名为 <code>value</code> 的配置参数，对此参数赋值，可以只写常量，相当于省略了 <code>value</code> 参数。</p>
<p><strong>有一些注解可以修饰其他注解 &ndash; 元注解（meta annotation）。</strong></p>
<p>这里，我们只了解两个常用的元注解： <code>@Target</code> 和 <code>@Retention</code> 。</p>
<p><strong><code>@Target</code></strong></p>
<p>最常用的元注解是 <code>@Target</code> ，它用来定义 Annotation 能够被应用于源码的哪些位置：</p>
<ul>
<li>类或接口： <code>ElementType.TYPE</code> ；</li>
<li>字段： <code>ElementType.FIELD</code> ；</li>
<li>方法： <code>ElementType.METHOD</code> ；</li>
<li>构造方法： <code>ElementType.CONSTRUCTOR</code> ；</li>
<li>方法参数： <code>ElementType.PARAMETER</code> 。</li>
</ul>
<p>实际上 <code>@Target</code> 定义的 <code>value</code> 是 <code>ElementType[]</code> 数组，只有一个元素时，可以省略数组的写法。</p>
<p><strong><code>@Retention</code></strong></p>
<p><code>@Retention</code> 定义了 Annotation 的生命周期：</p>
<ul>
<li>仅编译器（译后即丢）： <code>RetentionPolicy.SOURCE</code> ；</li>
<li>仅 class （不入 JVM）文件： <code>RetentionPolicy.CLASS</code> ；</li>
<li>运行期（加载进 JVM，供程序读取）： <code>RetentionPolicy.RUNTIME</code> 。</li>
</ul>
<p>如果 <code>@Retention</code> 不存在，则该 Annotation 默认为 <code>CLASS</code>，但其实通常我们自定义的 Annotation 都是 <code>RUNTIME</code> ，所以 <strong>务必要加上 <code>@Retention(RetentionPolicy.RUNTIME)</code> 这个元注解。</strong></p>
<p>OK，我们来总结一下定义 Annotation 的步骤：</p>
<ol>
<li>用 <code>@interface</code> 定义注解；</li>
<li>添加参数、默认值（把最常用的参数定义为 <code>value()</code> ，方便使用时直接写常量）；</li>
<li>用元注解配置注解。</li>
</ol>
<div class="oh-essay">
一直走在偷懒的路上，永不停歇……
</div>
<p>如这样：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Target</span><span style="color:#000;font-weight:bold">(</span>ElementType<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE</span><span style="color:#000;font-weight:bold">)</span>				<span style="color:#998;font-style:italic">// 3
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#3c5d5d;font-weight:bold">@Retention</span><span style="color:#000;font-weight:bold">(</span>RetentionPolicy<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">RUNTIME</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#3c5d5d;font-weight:bold">@interface</span> Report <span style="color:#000;font-weight:bold">{</span>				<span style="color:#998;font-style:italic">// 1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">type</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">default</span> 0<span style="color:#000;font-weight:bold">;</span>				<span style="color:#998;font-style:italic">// 2
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    String <span style="color:#900;font-weight:bold">level</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">default</span> <span style="color:#d14">&#34;info&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    String <span style="color:#900;font-weight:bold">value</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">default</span> <span style="color:#d14">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="处理注解">处理注解</h2>
<p>在日常生产环境中，我们基本上只需编写和使用 <code>RUNTIME</code> 类型的注解，所以我们只讨论它。前面已经说过，该类型注解是加载进 JVM 供程序读取的，那么如何读取呢？<strong>反射 API！</strong></p>
<p>使用反射 API 读取 Annotation：</p>
<ul>
<li><code>Class.getAnnotation(Class)</code> ；</li>
<li><code>Field.getAnnotation(Class)</code> ；</li>
<li><code>Method.getAnnotation(Class)</code> ；</li>
<li><code>Constructor.getAnnotation(Class)</code> ；</li>
</ul>
<p>如：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// 获取 Person 定义的@Report 注解：
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>Report report <span style="color:#000;font-weight:bold">=</span> Person<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAnnotation</span><span style="color:#000;font-weight:bold">(</span>Report<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> type <span style="color:#000;font-weight:bold">=</span> report<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">type</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>String level <span style="color:#000;font-weight:bold">=</span> report<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">level</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><p>如果读取时，Annotation 不存在，则返回 <code>null</code> 。</p>
<p>……</p>
<p>注意，定义了注解，本身对程序逻辑没有任何影响。我们必须自己编写代码来使用注解，<strong>检查逻辑完全是我们自己编写的，JVM 不会自动给注解添加任何额外的逻辑。</strong></p>
<h2 id="应用注解">应用注解</h2>
<blockquote>
<p>这时我们概览一下注解在 Web 开发中的常见应用形式。</p>
</blockquote>
<h3 id="在-servlet-中的应用">在 Servlet 中的应用</h3>
<p>在 JavaEE 平台上，处理 TCP 连接，解析 HTTP 协议这些底层工作统统扔给现成的 Web 服务器去做。我们使用 Servlet API 编写自己的 Servlet 来处理 Http 请求，Web 服务器实现 Servlet API 接口，实现底层功能：</p>
<pre tabindex="0"><code>                 ┌───────────┐
                 │My Servlet │
                 ├───────────┤
                 │Servlet API│
┌───────┐  HTTP  ├───────────┤
│Browser│&lt;──────&gt;│Web Server │
└───────┘        └───────────┘
</code></pre><p>注解在 Servlet 中如何应用呢？它有什么作用呢？</p>
<p><u>1. @WebServlet</u></p>
<p>我们知道，一个 Servlet 总是继承自 <code>HttpServlet</code> ，然后覆写 <code>doGet()</code> 或 <code>doPost()</code> 方法。如何知道客户端的请求地址呢？早期的 Servlet 使用 <code>web.xml</code> 文件来配置映射路径，现在我们使用注解 <code>@WebServlet</code> 来实现。如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// WebServlet 注解表示这是一个 Servlet ，并映射到地址 /hello:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#3c5d5d;font-weight:bold">@WebServlet</span><span style="color:#000;font-weight:bold">(</span>urlPatterns <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/hello&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">HelloServlet</span> <span style="color:#000;font-weight:bold">extends</span> HttpServlet <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">doGet</span><span style="color:#000;font-weight:bold">(</span>HttpServletRequest req<span style="color:#000;font-weight:bold">,</span> HttpServletResponse resp<span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">throws</span> ServletException<span style="color:#000;font-weight:bold">,</span> IOException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// 设置响应类型：
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        resp<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setContentType</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;text/html&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// 获取输出流：
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        PrintWriter pw <span style="color:#000;font-weight:bold">=</span> resp<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getWriter</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// 写入响应：
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        pw<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">write</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;&lt;h1&gt;Hello, world!&lt;/h1&gt;&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// 最后不要忘记 flush 强制输出：
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        pw<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">flush</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>浏览器发出的 HTTP 请求总是由 Web Server 先接收，然后，根据 Servlet 配置的映射，不同的路径转发到不同的 Servlet 。</p>
<p><u>2. @WebFilter</u></p>
<p>在一个复杂的 Web 应用程序中，通常有很多 URL 映射，对应的，也会有多个 Servlet 来处理 URL 。为了把一些公用逻辑从各个 Servlet 中抽离出来，JavaEE 的 Servlet 规范还提供了一种 Filter 组件，即过滤器。它的作用是，在 HTTP 请求到达 Servlet 之前，可以被一个或多个 Filter 预处理，类似打印日志、登录检查等逻辑，完全可以放到 Filter 中。</p>
<p>使用也很简单，来看一段示例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// 用 @WebFilter 注解标注该 Filter 需要过滤的 URL ，这里的 /* 表示所有路径
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#3c5d5d;font-weight:bold">@WebFilter</span><span style="color:#000;font-weight:bold">(</span>urlPatterns <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/*&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">EncodingFilter</span> <span style="color:#000;font-weight:bold">implements</span> Filter <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">doFilter</span><span style="color:#000;font-weight:bold">(</span>ServletRequest request<span style="color:#000;font-weight:bold">,</span> ServletResponse response<span style="color:#000;font-weight:bold">,</span> FilterChain chain<span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">throws</span> IOException<span style="color:#000;font-weight:bold">,</span> ServletException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;EncodingFilter:doFilter&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        request<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setCharacterEncoding</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;UTF-8&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setCharacterEncoding</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;UTF-8&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        chain<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">doFilter</span><span style="color:#000;font-weight:bold">(</span>request<span style="color:#000;font-weight:bold">,</span> response<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p><u>3. @WebListener</u></p>
<p>除了 Servlet 和 Filter 外，JaveEE 的 Servlet 规范还提供了第三种组件 - Listener （监听器） 。</p>
<p>有好几种 Listener ，其中最常用的是 <code>ServletContextListener</code> ，我们来编写一个实现该接口的类，如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@WebListener</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AppListener</span> <span style="color:#000;font-weight:bold">implements</span> ServletContextListener <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// 在此初始化 WebApp, 例如打开数据库连接池等：
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">contextInitialized</span><span style="color:#000;font-weight:bold">(</span>ServletContextEvent sce<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;WebApp initialized.&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// 在此清理 WebApp, 例如关闭数据库连接池等：
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">contextDestroyed</span><span style="color:#000;font-weight:bold">(</span>ServletContextEvent sce<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;WebApp destroyed.&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>任何标注为 <code>@WebListener</code> ，且实现了特定接口的类会被 Web 服务器自动初始化。</p>
<div class="oh-essay">
看，我们有钩子了 🥰
</div>
<p>一个 Web 服务器可以运行一个或多个 WebApp，对于每个 WebApp ，Web 服务器都会为其创建一个全局唯一的 <code>ServletContext</code> 实例，我们在上例中编写的两个回调方法实际上对应的就是 <code>ServletContext</code> 实例的创建和销毁。</p>
<h3 id="在-spring-中的应用">在 Spring 中的应用</h3>
<p>我们知道 Spring 的核心就是提供了一个 IoC 窗口，它可以管理所有轻量级的 JavaBean 组件。起初，Spring 也使用类似 XML 这样的配置文件，来描述 Bean 的依赖关系，然后让容器来创建并装配 Bean 。然而，这种方式虽然直观，写起来却很繁琐。</p>
<p><u>1. @Component 和 @Autowired</u></p>
<p>现在，我们可以使用 Annotation 来注解，让 Spring 自动扫描 Bean 并组装它们。如：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">MailService</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">UserService</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>	MailService mailService<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#998;font-style:italic">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>如上，这个 <code>@Component</code> 注解就相当于定义了一个 Bean ，它有一个可选的名称，默认是 <code>mailService</code> 、<code>userService</code> （小写开头的类名）。</p>
<p><code>@Autowired</code> 则相当于把指定类型的 Bean 注入到指定的字段中。它不但可以写在 <code>set()</code> 方法上，还可以直接写在字段上，甚至可以写在构造方法中。</p>
<p><u>2. @Configuration 和 @ComponentScan</u></p>
<p>要启动一个 Spring 应用，我们需要编写一个类启动容器，如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@ComponentScan</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AppConfig</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        ApplicationContext context <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> AnnotationConfigApplicationContext<span style="color:#000;font-weight:bold">(</span>AppConfig<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        UserService userService <span style="color:#000;font-weight:bold">=</span> context<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getBean</span><span style="color:#000;font-weight:bold">(</span>UserService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        User user <span style="color:#000;font-weight:bold">=</span> userService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">login</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;bob@example.com&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;password&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>user<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getName</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>其中， <code>@Configuration</code> 表示 <code>AppConfig.class</code> 是一个配置类，在创建 <code>ApplicationContext</code> 时，使用的实现类是 <code>AnnotationConfigApplicationContext</code> ，必须传入一个标注了 <code>@Configuration</code> 的类名。</p>
<p><code>@ComponentScan</code> 则告诉容器，自动搜索当前类所在的包以及子包，把所有标注为 <code>@Component</code> 的 Bean 自动创建出来，并根据 <code>@Autowired</code> 进行装配。</p>
<div class="oh-essay">
看，Ioc 容器其实啥都不知道，你需要用 Annotation 告诉它，做什么、怎么做、在哪做。
</div>
<p>使用 <code>@ComponentScan</code> 很方便，但是，我们也要特别注意包的层次结构。通常来说，启动配置类位于自定义的顶层包，其他 Bean 按类别放入子包。</p>
<p>思考一下，如何创建并配置一个第三方 Bean 呢？它并不在当前可搜索的包中！</p>
<p><u>3. @Bean</u></p>
<p>如果一个 Bean 不在我们自己的 package 管理之内，例如 <code>ZoneId</code> ，如何创建它？我们只需要在 <code>@Configuration</code> 配置类中编写一个 Java 方法（该方法使用 <code>@Bean</code> 注解）创建并返回它。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@ComponentScan</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AppConfig</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// 创建一个 Bean:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#3c5d5d;font-weight:bold">@Bean</span>
</span></span><span style="display:flex;"><span>    ZoneId <span style="color:#900;font-weight:bold">createZoneId</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> ZoneId<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">of</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Z&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p><u>4. @PropertySource</u></p>
<p>在开发应用程序时，经常需要读取配置文件，最常用的配置方法是以 <code>key=value</code> 的形式写在 <code>*.properties</code> 文件中。 Spring 提供了一个简单的 <code>@PropertySource</code> 来自动读取配置文件，只需要在配置类上再添加一个注解。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@ComponentScan</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@PropertySource</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;app.properties&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#998;font-style:italic">// 表示读取 classpath 的 app.properties
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AppConfig</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Value</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;${app.zone:Z}&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    String zoneId<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Bean</span>
</span></span><span style="display:flex;"><span>    ZoneId <span style="color:#900;font-weight:bold">createZoneId</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> ZoneId<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">of</span><span style="color:#000;font-weight:bold">(</span>zoneId<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>如上，Spring 容器看到 <code>@PropertySource(&quot;app.properties&quot;)</code> 注解后，就会自动读取这个配置文件，然后，我们使用 <code>@Value</code> 正常注入。</p>
<p><u>5. @Profile 和 @Conditional</u></p>
<p>创建某个 Bean 时，Spring 容器可以根据注解 <code>@Profile</code> 来决定是否创建，除此之外，也可以根据 <code>@Conditional</code> 来决定。</p>
<div class="oh-essay">
其实，还有其他的一些，blablabla…… 因为，Spring boot 提供了更好的，所以，我们在实际工作中并不怎么一些“老旧”的注解了。
</div>
<p><u>6. @Aspect 和 @EnableAspectJAutoProxy</u></p>
<p>当 Spring 的 IoC 容器看到 <code>@EnableAspectJAutoProxy</code> 这个注解，就会自动查找带有 <code>@Aspect</code> 的 Bean，然后根据每个方法的 <code>@Before、@Around</code> 等注解把 AOP 注入到特定的 Bean 中。</p>
<hr>
<p><u>7. @EnableTransactionManagement 和 @Transactional</u></p>
<p>Spring 提供了一个 <code>PlatformTransactionManager</code> 来表示事务管理器，所有的事务都由它负责管理。使用编程的方式使用 Spring 事务仍然比较繁琐，更好的方式是通过声明式事务来实现。</p>
<p>使用声明式事务非常简单，除了在配置类中追加一个定义的 <code>PlatformTransactionManager</code> 外，再添加一个 <code>@EnableTransactionManagement</code> 就可启用声明式事务。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@ComponentScan</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableTransactionManagement</span> <span style="color:#998;font-style:italic">// 启用声明式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#3c5d5d;font-weight:bold">@PropertySource</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;jdbc.properties&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AppConfig</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>然后，对需要事务支持的方法，加一个 <code>@Transactional</code> 注解。也可以直接加在 Bean 的 <code>class</code> 处，它表示其所有 <code>public</code> 方法都具有事务支持。</p>
<blockquote>
<p>Spring 对一个声明式事务的方法开启事务支持的原理，仍然是 AOP 代理，取了通过自动创建 Bean 的 Proxy 实现。</p>
</blockquote>
<h3 id="在-spring-mvc-中的应用">在 Spring MVC 中的应用</h3>
<blockquote>
<p>我们知道，Spring 提供的是一个 IoC 容器，所有的 Bean 都在该容器中被初始化。而 Servlet 容器由 JavaEE 服务器人提供（如 Tomcat）, Servlet 容器对 Spring 一无所知，它们之间依靠什么进行联系？又是以何种顺序初始化的呢？
详细答案请参考 <a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1282383921807393">如何关联 Servlet 和 Spring</a> 。</p>
</blockquote>
<p>只需要在配置类上加上 <code>@EnableWebMVC</code> 注意，就激活了 Spring MVC 。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// Controller 使用@Controller 标记而不是@Component:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#3c5d5d;font-weight:bold">@Controller</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">UserController</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// 正常使用 @Autowired 注入：
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    UserService userService<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// 处理一个 URL 映射：
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#3c5d5d;font-weight:bold">@GetMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> ModelAndView <span style="color:#900;font-weight:bold">index</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>这里，我们需要注意， Controller 使用 <code>@Controller</code> 标记，而不是 <code>@Component</code> 。（很明显，前者针对 Coontroller 做了一些增强）。</p>
<p>好的，现在我们来回答一下开始的问题 - 如何关联 Servlet 和 Spring ？</p>
<p>Spring MVC 提供了一个 <code>DispatcherServlet</code> 类，我们只需在 <code>web.xml</code> 中配置它。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;!DOCTYPE web-app PUBLIC
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"> &#34;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"> &#34;http://java.sun.com/dtd/web-app_2_3.dtd&#34; &gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;web-app&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;servlet&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;servlet-name&gt;</span>dispatcher<span style="color:#000080">&lt;/servlet-name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span style="color:#000080">&lt;/servlet-class&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;init-param&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;param-name&gt;</span>contextClass<span style="color:#000080">&lt;/param-name&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;param-value&gt;</span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext<span style="color:#000080">&lt;/param-value&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/init-param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;init-param&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;param-name&gt;</span>contextConfigLocation<span style="color:#000080">&lt;/param-name&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;param-value&gt;</span>com.itranswarp.learnjava.AppConfig<span style="color:#000080">&lt;/param-value&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/init-param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;load-on-startup&gt;</span>0<span style="color:#000080">&lt;/load-on-startup&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/servlet&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;servlet-mapping&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;servlet-name&gt;</span>dispatcher<span style="color:#000080">&lt;/servlet-name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;url-pattern&gt;</span>/*<span style="color:#000080">&lt;/url-pattern&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/servlet-mapping&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/web-app&gt;</span>
</span></span></code></pre></div><p>Servlet 容器会首先初始化 <code>DispatcherServlet</code> ，在 <code>DispatcherServlet</code> 启动时，根据配置类 <code>AppConfig</code> 创建一个类型是 <code>WebApplicationContext</code> 的 IoC 容器，完成所有 Bean 的初始化，并将该容器绑到 <code>ServletContext</code> 上。</p>
<p>如此， <code>DispatcherServlet</code> 持有 IoC 容器，自然就可以从 IoC 容器中获取所有的 <code>@Controller</code> 的 Bean ，在接收到 HTTP 请求后，根据 Controller 方法配置的路径转发到指定方法，并根据返回的 <code>ModelAndView</code> 决定如何渲染页面。</p>
<p>最后，在配置类 <code>AppConfig</code> 中通过 <code>main()</code> 方法启动嵌入式 Tomcat 即可。</p>
<p><u>1. @Controller</u></p>
<p>该注解用来标识当前 Bean 是一个 Controller 。Spring MVC 对 Controller 没有固定的要求，也不需要实现特定的接口，只需要在 Controller 类中，编写对应的方法处理相应的请求路径就可以了。</p>
<p><u>2. @GetMapping、@PostMapping、@RequestParam</u></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Controller</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">UserController</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#998;font-style:italic">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#3c5d5d;font-weight:bold">@PostMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/signin&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">public</span> ModelAndView <span style="color:#900;font-weight:bold">doSignin</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>		<span style="color:#3c5d5d;font-weight:bold">@RequestParam</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;email&#34;</span><span style="color:#000;font-weight:bold">)</span> String email<span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>		<span style="color:#3c5d5d;font-weight:bold">@RequestParam</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;password&#34;</span><span style="color:#000;font-weight:bold">)</span> String password<span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>		HttpSession session<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#998;font-style:italic">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>		<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>一个方法对应一个 HTTP 请求路径，用 <code>@GetMapping</code> 或 <code>@PostMapping</code> 表示 GET 或 POST 请求。</p>
<p>需要接收的 HTTP 参数以 <code>@RequestParam()</code> 标注。</p>
<p><u>2. @RestController</u></p>
<p>直接用 Spring 的 Controller 配合一大堆注解写 REST 太麻烦了，因此，Spring 额外提供了一个 <code>@RestController</code> 注解，使用它注解 Controller，每个方法自动变成 API 接口方法。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RestController</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/api&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ApiController</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    UserService userService<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@GetMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/users&#34;</span><span style="color:#000;font-weight:bold">)</span>				<span style="color:#998;font-style:italic">// 实际为 /api/users，下同
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">users</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> userService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getUsers</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@GetMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/users/{id}&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> User <span style="color:#900;font-weight:bold">user</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@PathVariable</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;id&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#458;font-weight:bold">long</span> id<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> userService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getUserById</span><span style="color:#000;font-weight:bold">(</span>id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@PostMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/signin&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">signin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@RequestBody</span> SignInRequest signinRequest<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            User user <span style="color:#000;font-weight:bold">=</span> userService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">signin</span><span style="color:#000;font-weight:bold">(</span>signinRequest<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">email</span><span style="color:#000;font-weight:bold">,</span> signinRequest<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">password</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> Map<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">of</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;user&#34;</span><span style="color:#000;font-weight:bold">,</span> user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> Map<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">of</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;error&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;SIGNIN_FAILED&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;message&#34;</span><span style="color:#000;font-weight:bold">,</span> e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMessage</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SignInRequest</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">public</span> String email<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">public</span> String password<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>如此，编写 REST 接口只需要定义 ｀＠RestController` ，然后每个方法都是一个 API 接口，输入和输出只要能被 Jackson 序列化或反序列化为 JSON 就没有问题。</p>
<p><u>3. @CrossOrigin</u></p>
<p>……</p>
<h3 id="在-spring-boot-中的应用">在 Spring Boot 中的应用</h3>
<p>Spring Boot 是什么？了解 <a href="../spring-boot/">她</a> 。</p>
<p><u>1. @SpringBootApplication</u></p>
<p>Spring Boot 要求 <code>main()</code> 方法所在的启动类必须放到 package 下，命名不作要求。启动 Spring Boot 应用程序只需要一行代码加上一个注解 <code>@SpringBootApplication</code> 即可。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@SpringBootApplication</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Application</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Exception <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        SpringApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">run</span><span style="color:#000;font-weight:bold">(</span>Application<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span> args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="oh-essay">
还要啥自行车，直接飞起了 🚀
</div>
<p><u>2. @ConditionalOnXxx</u></p>
<p>Spring 本身提供了条件装配 <code>@Conditional</code>，但是要自己编写比较复杂的 Condition 来做判断，比较麻烦。Spring Boot 则为我们准备好了几个非常有用的条件，如：</p>
<ul>
<li><code>@ConditionalOnProperty</code> ：如果有指定的配置，条件生效；</li>
<li><code>@ConditionalOnBean</code> ：如果有指定的 Bean，条件生效；</li>
<li><code>@ConditionalOnMissingBean</code> ：如果没有指定的 Bean，条件生效；</li>
<li><code>@ConditionalOnMissingClass</code> ：如果没有指定的 Class，条件生效；</li>
<li><code>@ConditionalOnWebApplication</code> ：在 Web 环境中条件生效；</li>
<li><code>@ConditionalOnExpression</code> ：根据表达式判断条件是否生效。</li>
</ul>
<p>……</p>
    </div>

    

    

    <div class="container-prevnext">
    <div><a href="https://loveminimal.github.io/posts/editor-keybindings/">← 键位映射那些事儿</a></div>
    <div><a href="https://loveminimal.github.io/posts/spring-boot/">Spring Boot  →</a></div>
</div>
    
    <div class="container-comment">
	<script src="https://utteranc.es/client.js"
        repo="loveminimal/comment"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
	</script>
</div>

    
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        豫ICP备2022002918号-1
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
    
</div></div>
    </body>
</html>
